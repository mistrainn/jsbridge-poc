<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- ã€å…³é”®ä¿®å¤1ã€‘é€‚é…æ‰‹æœºç«¯ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JSBridge è°ƒè¯•ä¸åˆ©ç”¨å·¥å…·</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; padding: 15px; background-color: #f0f2f5; }
        .container { max-width: 400px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; font-size: 20px; }
        button { display: block; width: 100%; padding: 15px; margin: 10px 0; font-size: 16px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; -webkit-tap-highlight-color: transparent; }
        button:hover { background-color: #0056b3; }
        button:active { transform: scale(0.98); }
        #log { margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 4px; white-space: pre-wrap; font-size: 12px; max-height: 300px; overflow-y: scroll; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>JSBridge è°ƒè¯•ä¸åˆ©ç”¨</h1>
        
        <button onclick="checkEnvironment()">1. æ£€æŸ¥ç¯å¢ƒ</button>
        <button onclick="testCallback()">2. æµ‹è¯• JS å›è°ƒ</button>
        <button onclick="testGetUserInfo()">3. çªƒå–ç”¨æˆ·ä¿¡æ¯</button>
        <button onclick="testOpenCamera()">4. æ‰“å¼€ç›¸æœº</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        
        <div id="log">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <script>
        new VConsole();
        const logEl = document.getElementById('log');
        let logCount = 0;
        function log(msg, type = 'info') {
            logCount++;
            const time = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logEl.innerHTML += `<div class="${className}">[${logCount}] [${time}] ${msg}</div>`;
            logEl.scrollTop = logEl.scrollHeight; // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        }

        function clearLog() {
            logEl.innerHTML = 'æ—¥å¿—å·²æ¸…ç©º\n';
            logCount = 0;
        }

        // ã€æ ¸å¿ƒã€‘å®šä¹‰å…¨å±€å›è°ƒå‡½æ•°
        function handleUserInfo(data) {
            // ã€å…³é”®ä¿®å¤2ã€‘å¢åŠ è°ƒè¯•ä¿¡æ¯
            log('ğŸ‰ğŸ‰ğŸ‰ handleUserInfo å›è°ƒè¢«æˆåŠŸè§¦å‘! ğŸ‰ğŸ‰ğŸ‰', 'success');
            log(`åŸç”Ÿè¿”å›çš„æ•°æ®: ${JSON.stringify(data)}`, 'success');
            // ä½¿ç”¨ alert å¯ä»¥æœ€ç›´è§‚åœ°ç¡®è®¤å›è°ƒæ˜¯å¦æˆåŠŸ
            alert('æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯! è¯·æŸ¥çœ‹æ§åˆ¶å°å’Œæ—¥å¿—ã€‚');
        }
        
        function handleCameraResult(data) {
            log('ğŸ‰ğŸ‰ğŸ‰ handleCameraResult å›è°ƒè¢«æˆåŠŸè§¦å‘! ğŸ‰ğŸ‰ğŸ‰', 'success');
            log(`ç›¸æœºæ“ä½œç»“æœ: ${JSON.stringify(data)}`, 'success');
            alert('ç›¸æœºå›è°ƒæˆåŠŸ! è¯·æŸ¥çœ‹æ§åˆ¶å°å’Œæ—¥å¿—ã€‚');
        }

        // è°ƒç”¨ PLUTO/IRS æ’ä»¶çš„é€šç”¨å‡½æ•°
        function callPlutoPlugin(pluginName, params, callbackName) {
            log(`--- å‡†å¤‡è°ƒç”¨æ’ä»¶: ${pluginName} ---`, 'info');
            if (!window.Android) {
                log('âŒ é”™è¯¯: window.Android å¯¹è±¡ä¸å­˜åœ¨!', 'error');
                return;
            }
            if (!window.Android.jsCallNative) {
                log('âŒ é”™è¯¯: window.Android.jsCallNative æ–¹æ³•ä¸å­˜åœ¨!', 'error');
                return;
            }
            
            try {
                const payload = {
                    method: pluginName,
                    data: params
                };
                log(`å‘é€çš„Payload: ${JSON.stringify(payload)}`, 'info');
                window.Android.jsCallNative(JSON.stringify(payload), callbackName);
                log('âœ… JSè°ƒç”¨å·²æˆåŠŸå‘èµ·ï¼Œç­‰å¾…Nativeå›è°ƒ...', 'info');
            } catch (e) {
                log(`âŒ è°ƒç”¨å¤±è´¥: ${e.message}`, 'error');
            }
        }
        
        // ã€æ–°å¢ã€‘ç¯å¢ƒæ£€æŸ¥å‡½æ•°
        function checkEnvironment() {
            clearLog();
            log('=== å¼€å§‹æ£€æŸ¥ç¯å¢ƒ ===', 'info');
            log(`window.Android æ˜¯å¦å­˜åœ¨: ${!!window.Android}`, window.Android ? 'success' : 'error');
            if (window.Android) {
                log(`window.Android.jsCallNative æ˜¯å¦å­˜åœ¨: ${!!window.Android.jsCallNative}`, window.Android.jsCallNative ? 'success' : 'error');
                log(`window.Android.H2C_JSBridge æ˜¯å¦å­˜åœ¨: ${!!window.Android.H2C_JSBridge}`, window.Android.H2C_JSBridge ? 'success' : 'error');
            }
            log(`window.handleUserInfo æ˜¯å¦å­˜åœ¨: ${!!window.handleUserInfo}`, window.handleUserInfo ? 'success' : 'error');
            log('=== ç¯å¢ƒæ£€æŸ¥å®Œæˆ ===', 'info');
        }

        // ã€æ–°å¢ã€‘ç›´æ¥æµ‹è¯•JSå›è°ƒå‡½æ•°
        function testCallback() {
            clearLog();
            log('=== æµ‹è¯• JS å›è°ƒå‡½æ•°æœ¬èº« ===', 'info');
            if (window.handleUserInfo) {
                log('âœ… handleUserInfo å‡½æ•°å­˜åœ¨ï¼Œå°è¯•ç›´æ¥è°ƒç”¨...', 'info');
                const testData = { code: "0", message: "This is a test from JS itself.", data: { test: "OK" } };
                window.handleUserInfo(testData);
            } else {
                log('âŒ handleUserInfo å‡½æ•°ä¸å­˜åœ¨!', 'error');
            }
        }

        function testGetUserInfo() {
            clearLog();
            callPlutoPlugin('getUserInfo', {}, 'handleUserInfo');
        }

        function testOpenCamera() {
            clearLog();
            callPlutoPlugin('openCamera', {}, 'handleCameraResult');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒ
        window.onload = () => {
            log('é¡µé¢åŠ è½½å®Œæˆ', 'info');
            checkEnvironment();
        };
    </script>
</body>
</html>
