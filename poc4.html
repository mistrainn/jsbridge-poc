<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSBridge PoC v5</title>
    <style>
        body { font-family: sans-serif; padding: 12px; }
        button { padding: 8px 14px; margin: 4px; }
        .pluto { background: #4CAF50; color: white; border: none; }
        .irs { background: #2196F3; color: white; border: none; }
        .xfb { background: #FF9800; color: white; border: none; }
        pre {
            border: 1px solid #ccc;
            padding: 8px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 12px;
        }
        h4 { margin: 15px 0 8px 0; color: #333; }
    </style>
</head>
<body>
<h3>JSBridge PoC v5</h3>

<h4>ğŸŸ¢ PLUTO åè®® (jsCallNative)</h4>
<button class="pluto" onclick="pluto_getUserInfo()">getUserInfo</button>

<h4>ğŸ”µ IRS åè®® (ihrbridge://)</h4>
<button class="irs" onclick="irs_openCamera()">openCamera</button>

<h4>ğŸŸ  XFB åè®® (H2C_JSBridge)</h4>
<button class="xfb" onclick="xfb_getUserInfo()">getUserInfo</button>
<button class="xfb" onclick="xfb_openCamera()">openCamera</button>

<h4>ğŸ“‹ æ—¥å¿—</h4>
<button onclick="document.getElementById('log').textContent=''">æ¸…ç©º</button>
<button onclick="detectEnv()">æ£€æµ‹ç¯å¢ƒ</button>
<pre id="log"></pre>

<script>
    var cbId = 0;

    function log(msg) {
        var el = document.getElementById('log');
        el.textContent += '[' + new Date().toLocaleTimeString() + '] ' + msg + '\n';
        el.scrollTop = el.scrollHeight;
    }

    function getCallbackId() {
        return 'cb_' + (++cbId) + '_' + Date.now();
    }

    // ========== å›è°ƒå‡½æ•°ï¼ˆä½¿ç”¨å‡½æ•°å£°æ˜ï¼Œå’Œ poc3 ä¿æŒä¸€è‡´ï¼‰==========

    // PLUTO å›è°ƒ
    function nativeCallback(data) {
        log('[PLUTO å›è°ƒ] ' + data);
    }

    // XFB å›è°ƒ - $C2H_JSBridge
    function $C2H_JSBridge(data) {
        log('[XFB å›è°ƒ] ' + data);
    }

    // IRS å›è°ƒ - IrsJSBridge.handleMessageFormNative
    var IrsJSBridge = {
        handleMessageFormNative: function(jsonStr) {
            log('[IRS å›è°ƒ] ' + jsonStr);
        }
    };

    // ========== ç¯å¢ƒæ£€æµ‹ ==========

    function detectEnv() {
        log('===== ç¯å¢ƒæ£€æµ‹ =====');
        log('window.Android: ' + (window.Android ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'));
        if (window.Android) {
            log('  - jsCallNative: ' + (typeof Android.jsCallNative));
            log('  - H2C_JSBridge: ' + (typeof Android.H2C_JSBridge));
        }
        log('window.WebViewJavascriptBridge: ' + (window.WebViewJavascriptBridge ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'));
    }

    // ========== PLUTO åè®® (getUserInfo åœ¨è¿™é‡Œ) ==========

    function pluto_getUserInfo() {
        log('--- [PLUTO] getUserInfo ---');
        if (!window.Android || typeof Android.jsCallNative !== 'function') {
            log('é”™è¯¯: Android.jsCallNative ä¸å­˜åœ¨');
            return;
        }
        var payload = {
            method: 'getUserInfo',
            data: {}
        };
        Android.jsCallNative(JSON.stringify(payload), 'nativeCallback');
        log('å·²è°ƒç”¨ï¼Œç­‰å¾…å›è°ƒ...');
    }

    // ========== IRS åè®® (openCamera åœ¨è¿™é‡Œ) ==========

    function irs_openCamera() {
        log('--- [IRS] openCamera ---');
        var id = getCallbackId();
        var params = JSON.stringify({
            handlerName: 'openCamera',
            isOpenAlbum: false
        });
        var url = 'ihrbridge://' + id + '/openCamera?' + params;
        log('URL: ' + url);

        // ç”¨ iframe è§¦å‘
        var iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = url;
        document.body.appendChild(iframe);
        setTimeout(function() {
            document.body.removeChild(iframe);
        }, 100);
        log('å·²è§¦å‘ï¼Œç­‰å¾…å›è°ƒ...');
    }

    // ========== XFB åè®® (å°è¯•ä¸¤ä¸ªæ–¹æ³•) ==========

    function xfb_getUserInfo() {
        log('--- [XFB] getUserInfo ---');
        if (!window.Android || typeof Android.H2C_JSBridge !== 'function') {
            log('é”™è¯¯: Android.H2C_JSBridge ä¸å­˜åœ¨');
            return;
        }
        var id = getCallbackId();
        var payload = {
            name: 'getUserInfo',
            param: '',
            cbID: id
        };
        Android.H2C_JSBridge(JSON.stringify(payload));
        log('å·²è°ƒç”¨ï¼Œç­‰å¾…å›è°ƒ...');
    }

    function xfb_openCamera() {
        log('--- [XFB] openCamera ---');
        if (!window.Android || typeof Android.H2C_JSBridge !== 'function') {
            log('é”™è¯¯: Android.H2C_JSBridge ä¸å­˜åœ¨');
            return;
        }
        var id = getCallbackId();
        var payload = {
            name: 'openCamera',
            param: JSON.stringify({ isOpenAlbum: false }),
            cbID: id
        };
        Android.H2C_JSBridge(JSON.stringify(payload));
        log('å·²è°ƒç”¨ï¼Œç­‰å¾…å›è°ƒ...');
    }

    // ========== é¡µé¢åŠ è½½ ==========

    window.onload = function() {
        log('é¡µé¢å·²åŠ è½½');
        log('æç¤º: getUserInfo ç”¨ PLUTO, openCamera ç”¨ IRS');
        log('');
        detectEnv();
    };
</script>
</body>
</html>