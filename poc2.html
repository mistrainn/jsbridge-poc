<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSBridge æµ‹è¯•å·¥å…·</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; }
        button { display: block; width: 100%; padding: 12px; margin: 8px 0; font-size: 16px; cursor: pointer; }
        #log { margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 4px; white-space: pre-wrap; font-size: 14px; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
    </style>
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
</head>
<body>
    <h1>JSBridge æµ‹è¯•å·¥å…·</h1>
    <button onclick="scanAndroid()">æ‰«æ window.Android æ–¹æ³•</button>
    <button onclick="testBridge()">æµ‹è¯•æ‰€æœ‰ JSBridge è°ƒç”¨</button>
    <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    
    <div id="log">ç­‰å¾…æ“ä½œ...</div>

    <script>
        new VConsole();

        const logEl = document.getElementById('log');
        function log(msg, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            logEl.innerHTML += `<div class="${className}">[${time}] ${msg}</div>`;
            console.log(`[${time}] ${msg}`);
        }

        function clearLog() {
            logEl.innerHTML = '';
        }

        // æ‰«æå¹¶åˆ—å‡º window.Android çš„æ‰€æœ‰æ–¹æ³•
        function scanAndroid() {
            clearLog();
            log('=== æ‰«æ window.Android ===');
            
            if (!window.Android) {
                log('âŒ window.Android ä¸å­˜åœ¨', 'error');
                return;
            }

            log('âœ… å‘ç° window.Android å¯¹è±¡');
            log('æ–¹æ³•åˆ—è¡¨:');
            
            const methods = [];
            for (let key in window.Android) {
                const type = typeof window.Android[key];
                if (type === 'function') {
                    methods.push(`  ğŸ“Œ ${key}()`);
                } else {
                    methods.push(`  ğŸ“ ${key}: ${type}`);
                }
            }
            
            if (methods.length === 0) {
                log('  æœªæ‰¾åˆ°ä»»ä½•æ–¹æ³•æˆ–å±æ€§');
            } else {
                methods.forEach(m => log(m));
            }
            
            log(`=== æ‰«æå®Œæˆï¼Œå…±æ‰¾åˆ° ${methods.length} ä¸ªæ–¹æ³•/å±æ€§ ===`);
        }

        // æµ‹è¯• JSBridge è°ƒç”¨
        function testBridge() {
            clearLog();
            log('=== å¼€å§‹æµ‹è¯• JSBridge ===');
            
            if (!window.Android) {
                log('âŒ window.Android ä¸å­˜åœ¨', 'error');
                return;
            }

            // æµ‹è¯•1: ç›´æ¥è°ƒç”¨
            log('\n--- æµ‹è¯•1: ç›´æ¥è°ƒç”¨ getUserInfo ---');
            if (window.Android.getUserInfo) {
                try {
                    const result = window.Android.getUserInfo();
                    log(`ğŸ‰ è°ƒç”¨æˆåŠŸ: ${JSON.stringify(result)}`, 'success');
                } catch (e) {
                    log(`âŒ è°ƒç”¨å¤±è´¥: ${e.message}`, 'error');
                }
            } else {
                log('âš ï¸ æ–¹æ³•ä¸å­˜åœ¨ï¼Œè·³è¿‡');
            }

            // æµ‹è¯•2: ç»Ÿä¸€æ¥å£
            log('\n--- æµ‹è¯•2: ç»Ÿä¸€æ¥å£ call ---');
            if (window.Android.call) {
                try {
                    window.Android.call('getUserInfo', {}, (result) => {
                        log(`ğŸ‰ å›è°ƒæˆåŠŸ: ${JSON.stringify(result)}`, 'success');
                    });
                    log('âœ… å·²å‘èµ·è°ƒç”¨ï¼Œç­‰å¾…å›è°ƒ...');
                } catch (e) {
                    log(`âŒ è°ƒç”¨å¤±è´¥: ${e.message}`, 'error');
                }
            } else {
                log('âš ï¸ æ–¹æ³•ä¸å­˜åœ¨ï¼Œè·³è¿‡');
            }

            // æµ‹è¯•3: å…¶ä»–å¸¸è§æ–¹æ³•
            const commonMethods = ['getDeviceInfo', 'getToken', 'getLocation', 'scanQRCode'];
            commonMethods.forEach(method => {
                if (window.Android[method]) {
                    log(`\n--- å‘ç°å¸¸è§æ–¹æ³•: ${method} ---`);
                    try {
                        const result = window.Android[method]();
                        log(`ğŸ‰ ${method} è°ƒç”¨æˆåŠŸ: ${JSON.stringify(result)}`, 'success');
                    } catch (e) {
                        log(`âŒ ${method} è°ƒç”¨å¤±è´¥: ${e.message}`, 'error');
                    }
                }
            });
            
            log('\n=== æµ‹è¯•å®Œæˆ ===');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰«æ
        window.onload = () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•');
            scanAndroid();
        };
    </script>
</body>
</html>
